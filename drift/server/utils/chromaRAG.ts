import { QdrantVectorStore } from "@langchain/qdrant";
import { HuggingFaceTransformersEmbeddings } from "@langchain/community/embeddings/huggingface_transformers";
import type { Document } from "@langchain/core/documents";
import { RecursiveCharacterTextSplitter } from "@langchain/textsplitters";

const embeddings = new HuggingFaceTransformersEmbeddings({
  model: "Xenova/all-MiniLM-L6-v2",
});

// Test Qdrant Cloud connection
export async function testQdrantConnection(): Promise<boolean> {
  try {
    const qdrantUrl = process.env.QDRANT_URL || "http://localhost:6333";
    const qdrantKey = process.env.QDRANT_API_KEY;
    
    console.log("üîç Testing Qdrant connection...");
    console.log("URL:", qdrantUrl.substring(0, 30) + "...");
    console.log("Has API Key:", qdrantKey ? "Yes" : "No");
    
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
    };
    
    if (qdrantKey) {
      headers['api-key'] = qdrantKey;
    }
    
    const response = await fetch(`${qdrantUrl}/collections`, {
      method: 'GET',
      headers,
      signal: AbortSignal.timeout(10000) // 10 second timeout
    });
    
    if (response.ok) {
      console.log("‚úÖ Qdrant connection successful");
      return true;
    } else {
      console.error(`‚ùå Qdrant responded with status: ${response.status}`);
      const errorText = await response.text();
      console.error("Error details:", errorText);
      return false;
    }
  } catch (error: any) {
    console.error("‚ùå Qdrant connection failed:", error.message);
    return false;
  }
}

(async () => {
  const testEmbedding = await embeddings.embedQuery("test");
  console.log("Test embedding:", testEmbedding);
  
  // Test Qdrant connection on startup
  const connectionOk = await testQdrantConnection();
  
  // Populate knowledge base on startup (only if empty)
  if (connectionOk) {
    try {
      await addDocs();
      console.log("üìö Knowledge base populated on startup");
    } catch (error) {
      const errorMessage = error instanceof Error ? error.message : String(error);
      console.log("üìö Knowledge base already exists or failed to populate:", errorMessage);
    }
  }
})();

// Export a promise that resolves to the vector store
export const vectorStorePromise = (async () => {
  try {
    console.log("üöÄ Initializing Qdrant vector store...");
    return await QdrantVectorStore.fromDocuments(
      [], // Start with empty documents
      embeddings,
      {
        url: process.env.QDRANT_URL || "http://localhost:6333",
        apiKey: process.env.QDRANT_API_KEY,
        collectionName: "drift-collection-qdrant",
      }
    );
  } catch (error) {
    console.error("‚ùå Failed to initialize Qdrant vector store:", error);
    throw error;
  }
})();


// Add documents
export async function addDocs() {
  const vectorStore = await vectorStorePromise;
  const docs: Document[] = [
    { pageContent: "Overview of The Muscle Ladder: Get Jacked Using Science The book is a comprehensive, science-based guide to building muscle and developing a strong physique, suitable for beginners, intermediates, and advanced lifters. It uses a ladder metaphor to organize training principles: two vertical rails (sustainability and mindset) provide foundational support, while ten horizontal rungs represent prioritized variables for muscle growth, starting from basics and ascending to advanced concepts. The structure emphasizes focusing on mechanical tension as the primary driver of hypertrophy, asking the right questions for progress, and avoiding myths. It includes explanations of how and why for each principle, backed by research, with practical applications. Additional chapters cover nutrition, supplements, cardio, lifestyle factors, and 20 sample workout programs adaptable to 2-6 days per week, including full-body, upper/lower, push/pull/legs, body-part splits, and hybrids. The book features photo demonstrations for over 80 exercises, muscle diagrams, and serves as a reference for technique, programming, and common questions. It totals around 384 pages, with full-color images and an index, aiming to turn readers into their own fitness experts for long-term, sustainable gains. ### Chapter 1: Setting Up the Ladder This introductory chapter explains the ladder framework: rails as constant supports and rungs as progressive steps. It outlines how beginners should focus on lower rungs for foundational gains, while advanced lifters climb higher for optimization. The ladder prioritizes variables by impact on hypertrophy, ensuring efficient progress without overwhelming details. It stresses that results depend on applying principles consistently, with the structure allowing readers to troubleshoot plateaus by addressing specific rungs. ### Chapter 2: Sustainability - Will This Work Long Term? (Rail 1) Sustainability is one rail, ensuring training leads to maintainable gains. Key angles: enjoyment by selecting preferred exercises and routines to prevent burnout; safety through proper form, gradual progression, and injury prevention; pacing by listening to the body, incorporating deloads (reducing volume 50% every 4-8 weeks), and avoiding overtraining; realistic expectations, as progress slows over time (e.g., beginners gain faster than advanced). Without sustainability, dropout or injury halts progress. Examples include choosing machine variations if free weights cause discomfort and viewing training as a lifelong habit rather than a quick fix. ### Chapter 3: Mindset - Thinking Your Way to Gains (Rail 2) The other rail, mindset, drives adherence and maximum effort. Angles: positive self-talk for motivation during tough sets; building self-trust in one's ability to progress; resilience against plateaus by focusing on process over outcomes; treating training as an enjoyable habit. It integrates with all rungs, as psychological barriers can undermine physical execution. Examples: Using encouraging internal dialogue like You've got this and reframing failures as learning opportunities. The book notes mindset is crucial, as gains require consistent follow-through. ### Chapter 4: Technique - How to Lift the Weights (Rung 1) Technique is the foundational rung for maximizing muscle stimulation and minimizing injury. Angles: Control the eccentric (negative) phase for tension; use full range of motion (ROM) unless injury-limited; minimize momentum to avoid cheating; breathe by exhaling on exertion. Detailed instructions and photos for exercises emphasize proper form. Why: Poor technique reduces effectiveness and risks harm. Examples: Squats with upright torso and depth to parallel; bench press with elbows tucked at 45 degrees; deadlifts with neutral spine. Beginners must master this before advancing. ### Chapter 5: Exercise Selection - What Exercises Should I Do? (Rung 2) Focuses on choosing movements that target muscles effectively based on biomechanics and individual anatomy. Angles: Prioritize the Big Six compounds‚Äîsquat-type (e.g., barbell back squat), hip hinge (e.g., deadlift), vertical push (e.g., overhead press), horizontal push (e.g., bench press), vertical pull (e.g., pull-up), horizontal pull (e.g., row)‚Äîfor efficiency; add isolations (e.g., curls, extensions) for specifics. Match exercises to body proportions (e.g., front squats for long femurs). Muscle-by-muscle guides ensure balanced coverage. Examples: Back requires both vertical and horizontal pulls; legs mix quad-dominant (squats) and hamstring-dominant (RDLs). Photos demonstrate over 80 exercises. ### Chapter 6: Effort - How Hard Should I Push? (Rung 3) Effort involves training close to failure to recruit high-threshold motor units via mechanical tension. Angles: Use RPE (1-10 scale) and RIR (reps in reserve, e.g., 2 RIR means stop with 2 reps left); aim for 0-3 RIR on most sets for hypertrophy. Avoid constant failure to manage fatigue. Why: Insufficient effort limits growth. Examples: On a 10-rep set, if 12 are possible, that's 2 RIR; adjust based on feel. ### Chapter 7: Progressive Overload - How Do I Make Progress? (Rung 4) Core principle of increasing challenge to signal adaptation. Angles: Add weight, reps, sets, or improve form/ROM; track via logs; use double progression (increase reps before weight). Dismiss muscle confusion myths‚Äîconsistency matters. Examples: From 225x8 bench to 225x9; apply to all levels, but plateaus require higher rungs. ### Chapter 8: Volume - How Much Should I Do? (Rung 5) Optimal sets per muscle per week. Angles: Beginners 10 sets; intermediates/advanced 10-20, up to 25+ for lagging areas; distribute across sessions; monitor recovery with landmarks (minimum effective volume, maximum adaptive/recoverable). Avoid junk volume. Examples: Quads 12-16 sets; training volume is a moving target based on response. ### Chapter 9: Training Splits and Frequency - How Often Should I Train? (Rung 6) Organizing workouts for balance. Angles: Splits like full-body (beginners), upper/lower, PPL, bro-split; frequency 1-3x per muscle/week if volume equated; pros/cons for recovery and schedule. Examples: 4-day upper/lower (Upper A, Lower A, rest, Upper B, Lower B); structure freely as long as bases covered. ### Chapter 10: Load and Rep Ranges - How Heavy? How Many Reps? (Rung 7) Balancing intensity and reps. Angles: 6-15 reps for hypertrophy (lower for compounds, higher for isolations); 1-5 for strength; mix for complete stimulus including metabolic stress. Examples: Squats 6-10 heavy; lateral raises 10-20; getting stronger builds muscle. ### Chapter 11: Rest Periods - How Long Should I Rest Between Sets? (Rung 8) Time between sets for recovery. Angles: 1-2 min isolation, 2-3 min light compounds, 3-5 min heavy; shorter for metabolites, longer for load maintenance. Examples: Curls 90 sec; deadlifts 4 min; rest as needed for optimal performance. ### Chapter 12: Advanced Techniques - How Can I Level Up My Training? (Rung 9) For plateaus, selectively use intensifiers on 10-20% of sets. Angles: Long-length partial reps, drop sets (reduce weight 20% after failure), myo-reps (activation set + mini-sets), forced reps, supersets. Why: Spark growth without overtaxing. Examples: Drop set continuation post-failure; for advanced lifters only. ### Chapter 13: Periodization - How Should I Organize My Training Over Time? (Rung 10) Structuring cycles to prevent stagnation. Angles: Macrocycles (yearly), mesocycles (4-12 weeks), microcycles; models like linear (increase intensity), reverse, weekly undulating; include deloads. Examples: Linear from 12 reps to 6 heavier over weeks. ### Chapter 14: Nutrition - How Should I Eat to Build Muscle? Calories in vs. out foundation. Angles: Calculate maintenance, bulk +200-500 kcal, cut -300-500, recomposition at neutral; protein 1.6-2.2g/kg bodyweight, fats 20-30%, carbs remainder; fiber 25-38g/day; flexible dieting (80/20). Surplus for growth, deficit for loss. Examples: 80kg person: 160g protein; track apps; intricate ROM and muscle diagrams aid understanding; poor nutrition derails recovery. ### Chapter 15: Supplements - What Supplements Should I Take? Supportive tools, not essential, tiered by evidence. Angles: Tier 1 (high): protein powder, creatine 5g/day, caffeine 3-6mg/kg pre-workout; Tier 2 (moderate): multivitamin, fish oil 1-2g EPA/DHA; Tier 3 (situational): L-citrulline 6-8g for pump, melatonin for sleep. Avoid overhyped like BCAAs. Not FDA-evaluated, not for disease treatment. ### Chapter 16: Cardio and Other Lifestyle Factors - What Else Affects Muscle Growth? Cardio for health/fat loss, not antagonistic to gains. Angles: HIIT 1-2x/week (20-30 min), LISS (walking) for NEAT/recovery; sleep 7-9 hours consistent; stress management (meditation, journaling). Recovery crucial. Examples: Post-workout walk; train with confidence, not fear. ### Chapter 17: Sample Workout Programs - Putting It All Together 20 flexible programs for all levels and splits. Angles: Beginner programs lower volume (8-10 sets/muscle), machine-focused for safety; intermediates/advanced incorporate techniques. Examples: Beginner PPL - Push (bench, overhead, triceps), Pull (rows, pull-ups, biceps), Legs (squats, RDLs); adaptable to schedules. ### Key Overall Takeaways and Quotes - The ladder builds progressively; top rungs for plateaus. - Comprehensive for physique improvement, simplifying concepts. - Quotes: By the time you reach the top, you‚Äôll be answering questions instead of asking them. Technique is what allows you to train long enough and hard enough to reach your goals. The next eight steps won‚Äôt matter without the appropriate effort. Results depend on progressively increasing your strength, skill, and capacity in the gym. Training volume is a moving target. As long as you have those bases covered, you‚Äôre free to structure your training schedule to make it work for you. If you‚Äôre getting stronger, you‚Äôre almost certainly gaining muscle. Your rest periods should be exactly as long as they need to be for you to get the most out of every set of every exercise in your program. When plateaus become frequent, you may need to spice up your training with selective use of long-length partial reps, myo-reps, drop sets, and other hypertrophy techniques to spark new growth. As you step off this final rung, you‚Äôll have all the knowledge you need to create a long-term training plan. Truly poor nutrition can derail your recovery. The best way to avoid getting hurt in the gym is to train with confidence rather than fear.", metadata: { category: "fitness" } },
    { pageContent: "Overview of Guide to Academic Success The guide provides strategies for effective studying productivity and career preparation emphasizing evidence-based techniques over common inefficient methods to achieve high performance while maintaining balance in school extracurriculars and personal life through active learning spaced repetition interleaving optimized breaks and practical tips for habits resumes and interviews. ### Introduction Discusses common student struggles like intense studying yielding low grades due to ineffective methods advocating learning how to learn for better retention less time spent and enjoyment of other activities covering pitfalls evidence-based techniques productivity hacks advice resume writing and interview tips. ### Why Listen to Me Highlights success in rigorous high school honors AP dual enrollment and college biomedical engineering BS/MS with 20-credit loads deans list while engaging in leadership clubs sports research internships at West Pharmaceutical Services GlaxoSmithKline entrepreneurship scholarship and family business help social life gym social media with 3M+ followers emphasizing techniques tested across disciplines like engineering biology computer science calculus composition material science anatomy entrepreneurship for efficiency and balance. ### What You Are Likely Doing Wrong Identifies traps like equating more hours to better performance leading to burnout pretty notes passive low utility wanting easy studying ignoring Yerkes-Dodson for optimal stress Parkinsons Law for intense short sessions and forgetting curve causing rapid loss without review inefficient for cumulative exams higher education. ### Evidence-Based Learning Techniques Details four principles for durable learning via sensory working long-term memory processes. ### Principle One Active Recall Defines deliberate retrieval strengthening pathways over cued flashcards illusion of knowing favoring synthesis reorganization comparison application contextualization with experiments showing retrieval outperforming repeated study concept mapping by 50% on verbatim inference questions despite inaccurate metacognitive predictions applying via pre-class prep familiarizing not memorizing in-class questions on fundamentals relations examples applications real-world without perfect wording immediate review struggling to answer deepening understanding Feynman technique simplifying for fifth grader revealing gaps blurting closing source writing comparing revising iterations for organization exam simulation past papers 7-step process attempting explaining distractors using class questions textbook checking for gaps. ### Principle Two Spaced Repetition Counters forgetting curve reviewing just before forgetting for desirable difficulty flattening curve shorter early intervals longer later with experiment showing spaced recall outperforming massed by 75% same time applying Leitner boxes/cards moving forward on success back on failure end-of-day 20-min retrieval for 70% retention reduction prospective timetables forward-planning blocks retrospective color-coding prioritizing unfamiliar/randomizing digital algorithms like Anki supplemental to free recall. ### Principle Three Interleaved Practice Mixes topics over blocked for spacing discernment real-world exam mimicry with experiment showing 30%+ grade boost applying switching subjects/topics in sessions homework post-familiarization ideal 25-90 min switches per ultradian rhythms. ### Principle Four Optimized Breaks Leverages rewiring in relaxation post-focus via naps 10-20 min for energy non-sleep deep rest guided meditations gap effects 1-10 sec idles 3-5 times/hour micro-rests random buzzers releasing tension reducing stress accelerating replays. ### Actually Putting Together the Perfect Study System Outlines syllabus topic identification daily pre-class prep in-class questions end-of-day review weekly interleaving spaced timetables homework/past papers blurting/Feynman encouraging experimentation for optimal personal system. ### Productivity Tips Leverage peak energy windows tracking experimenting aligning deep work second brain digital repository capturing organizing retrieving ideas for offloading building on past freeing creativity time blocking monthly/weekly/daily scheduling urgency realistic allocation timing tasks 5 minute rule starting small overcoming resistance 321 countdown acting on 1 eliminating second-guessing Pomodoro 25/45-min focus 5-min breaks night alarm two-stage winding down disengaging electronics stacking micro wins building momentum confidence mindfulness morning meditation intentions for presence alignment. ### Personal Advice for Students Develop network early class chats peer/teaching groups faculty connections for help recommendations research high value skills market demand transferability specialization future relevance earning like programming cloud data sales design content embracing difficulty resilience advanced classes good habits sleep study exercise cooking management cleanliness independence avoiding skipping cramming indoors imbalance no help dependency oversleeping. ### Resume Writing Focus impact quantifiable metrics 3-fold enhancement creating context standing out include keywords soft skills technical balance concise 475-600 words tailored versions reviewer mind comprehensive LinkedIn showcasing experiences networks personality shared interests customized URL. ### Interview Tips Strong introduction name background concentration motivation experiences alignment enthusiasm closing gratitude reiteration interest fit next steps emails final positive never tell show stories behavioral questions STAR situation task action result prepared questions demonstrating interest genuine assessment research company website LinkedIn Glassdoor Indeed current/previous employees for insights standing out. ### Closing Remarks Encourages integrating strategies for academic success believing in potential power persistence.", metadata: { category: "study" } },
    { pageContent: "Overview of The Seven Habits of Highly Effective People The book outlines seven habits based on timeless principles for personal and professional effectiveness shifting from personality ethic quick fixes to character ethic foundational traits like integrity emphasizing Inside-Out change starting with self for paradigm shifts to principle-centered living through private victories independence public victories interdependence and renewal. ### Part One: Paradigms and Principles - Inside Out Explains Inside-Out approach focusing on character over superficial techniques using examples of perception shifts like parenting challenges revealing underlying paradigms contrasting short-term personality tactics with long-term character building leading to primary greatness inner goodness over secondary social recognition. ### The Power of a Paradigm Describes paradigms as subjective maps influencing behavior with shifts enabling quantum change from negative to positive directions advocating focus on root paradigms for deep improvements. ### The Power of a Paradigm Shift Illustrates paradigm impacts with stories like lighthouse confrontation standing on principles and defines principles as universal natural laws like fairness and growth aligning maps for accuracy and effectiveness. ### See-Do-Get Cycle Links paradigms to behaviors and results using farm analogy for natural processes impossible to cram applying to development where timing avoids perceived judgment in strained relations. ### The Principle-Centered Paradigm Promotes centering on unchanging principles over variable centers like family or money reducing dependency and vulnerability for stable proactive living. ### The Way We See the Problem is the Problem Identifies problems from paradigms requiring principle-based deeper thinking for effective interactions. ### A New Level of Thinking Advocates paradigm shifts to interdependence recognizing ecological systems in nature and society defining habits at knowledge skill desire intersection for effectiveness along maturity continuum from dependence to independence to interdependence. ### Effectiveness Defined Introduces P/PC balance for sustainable results using golden goose fable applying to assets relationships and self where neglect diminishes capacity. ### Habit 1: Be Proactive Distinguishes proactive choice-based responses from reactive condition-driven ones using Frankl's camp freedom to highlight endowments self-awareness imagination conscience will enabling circle of influence focus over concern expansion through positive choices. ### Taking the Initiative Urges acting to create circumstances exercising proactive muscles for growth opportunities in individuals and organizations. ### Listening to Our Language Contrasts proactive choice language with reactive deterministic terms reflecting underlying attitudes. ### Circle of Influence/Circle of Concern Advises focusing on influence to expand it addressing direct habit indirect method and no-control attitude problems with serenity prayer perspective. ### Consequences and Mistakes Notes choices lead to natural or social consequences but response freedom remains using Joseph's rise as example. ### Making and Keeping Commitments Builds character via promises and goals central to influence. ### Proactivity Defined As responsibility fundamental to all habits. ### Habit 2: Begin with the End in Mind Uses end visualization for value clarification leading to mental first creation preceding physical for leadership over management rescripting default influences with personal mission statements based on principles. ### All Things Are Created Twice Emphasizes proactive design over default with examples like home construction. ### Rescripting Promotes mission statements as constitutions reflecting uniqueness via right-brain visualization and affirmation. ### At the Center Warns of dependency from centers like spouse or money impacting security guidance wisdom power. ### A Principle Center Provides stable security wise guidance unlimited power putting others in perspective. ### Writing and Using a Personal Mission Statement Involves roles goals regular review for decision criteria. ### Family and Organizational Mission Statements Foster shared vision through involvement for buy-in and culture like service-oriented hotel staff. ### Habit 3: Put First Things First Exercises independent will for management organizing priorities from mission via Quadrant II focus on important non-urgent prevention and building avoiding crises urgencies waste. ### Power of Independent Will Enables acting on principles over impulses for integrity. ### Quadrant II Organizes around roles goals weekly scheduling daily adapting with conscience for balance. ### Delegation Shifts from gofer methods to stewardship results focus empowering via desired results guidelines resources accountability consequences. ### Part Three: Public Victory - Paradigms of Interdependence Stresses emotional bank accounts for trust through deposits like understanding kindness honesty building reserves for withdrawals in interdependent realities requiring character maturity. ### Six Major Deposits Details understanding individual attending small things keeping commitments clarifying expectations integrity apologizing unconditional love as laws fostering growth. ### P Problems are PC Opportunities Views problems as capability building for production. ### Habits of Interdependence Require independence first for true Public Victory. ### Habit 4: Think Win-Win Promotes mutual benefit abundance mentality over scarcity win-lose lose-win etc in interdependent situations building character integrity maturity abundance for agreements processes systems. ### Six Paradigms of Human Interaction Analyzes win-win as only viable long-term with no deal alternative if needed. ### Win-Win Character Involves integrity maturity abundance mentality for genuine cooperation. ### Relationships and Agreements Build trust via emotional accounts and clear performance criteria with systems aligning to win-win. ### Processes Seek third alternatives through understanding. ### Habit 5: Seek First to Understand Then to Be Understood Advocates empathic listening over autobiographical responses like evaluating probing advising interpreting for accurate diagnosis before prescribing using ethos pathos logos sequence. ### Character and Communication Bases on integrity for open influence. ### Empathic Listening Transforms by providing psychological air fostering openness beyond content to feelings. ### Diagnose Before You Prescribe Applies to all fields for wise solutions. ### Four Autobiographical Responses Contrasts with empathic rephrasing content reflecting feeling for deeper understanding. ### Understanding and Perception Opens influence as needs met. ### Then Seek to Be Understood Presents from others frame courageously balanced with empathy. ### One on One Builds through regular empathic interactions. ### Habit 6: Synergize Values differences for creative cooperation where whole exceeds parts as in nature ecology seeking third alternatives through trust openness. ### Synergistic Communication Achieves high trust high cooperation for new solutions. ### Valuing the Differences Leverages mental emotional psychic variances for synergy requiring security humility. ### Force Field Analysis Uses driving restraining forces transformed via involvement. ### All Nature is Synergistic Interrelates everything maximizing creative powers in relationships. ### Habit 7: Sharpen the Saw Renews physical social/emotional spiritual mental dimensions balanced proactively for effectiveness like exercise nutrition service reading planning. ### Four Dimensions of Renewal Physical via exercise endurance flexibility strength social/emotional via empathy intrinsic security spiritual via mission review literature mental via reading visualizing planning. ### Scripting Others Empowers by seeing potential affirming proactively. ### Balance in Renewal Addresses organizational dimensions too for holistic growth. ### Synergy in Renewal Creates upward spiral of learn commit do. ### Inside-Out Again Reinforces starting with self for intergenerational impact becoming transition persons breaking negative cycles through forgiveness positive scripting.", metadata: { category: "work" } },
  ];
  // await vectorStore.addDocuments(docs, { ids: [
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abc",
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abd",
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abe"
  // ] });

  // Split each doc into smaller chunks
  const splitter = new RecursiveCharacterTextSplitter({ chunkSize: 500, chunkOverlap: 50 });
  let splitDocs: Document[] = [];
  for (const doc of docs) {
    const chunks = await splitter.splitText(doc.pageContent);
    splitDocs.push(...chunks.map(chunk => ({
      pageContent: chunk,
      metadata: doc.metadata,
    })));
  }

  await vectorStore.addDocuments(splitDocs);
  console.log("Knowledge base updated successfully")
}

// Query documents
export async function queryDocs(query: string, category: string) {
  const vectorStore = await vectorStorePromise;
  
  // Get more results without category filter, then filter manually
  const results = await vectorStore.similaritySearch(query, 6);
  
  // Filter results by category manually 
  const filteredResults = results.filter(doc => 
    doc.metadata?.category === category
  ).slice(0, 2);
  
  // If no category matches, return top 2 general results
  const finalResults = filteredResults.length > 0 ? filteredResults : results.slice(0, 2);
  
  console.log("Relevant knowledge extracted")
  return finalResults;
}