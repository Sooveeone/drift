import { QdrantVectorStore } from "@langchain/qdrant";
import { HuggingFaceTransformersEmbeddings } from "@langchain/community/embeddings/huggingface_transformers";
import type { Document } from "@langchain/core/documents";
import { RecursiveCharacterTextSplitter } from "@langchain/textsplitters";

const embeddings = new HuggingFaceTransformersEmbeddings({
  model: "Xenova/all-MiniLM-L6-v2",
});

// Function to check Qdrant connection
export async function checkQdrantConnection(): Promise<boolean> {
  try {
    const response = await fetch('http://localhost:6333/collections', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
      signal: AbortSignal.timeout(5000) // 5 second timeout
    });
    
    if (response.ok) {
      console.log("✅ Qdrant connection successful");
      return true;
    } else {
      console.error(`❌ Qdrant responded with status: ${response.status}`);
      return false;
    }
  } catch (error: any) {
    console.error("❌ Qdrant connection failed:", error.message);
    return false;
  }
}

(async () => {
  const testEmbedding = await embeddings.embedQuery("test");
  console.log("Test embedding:", testEmbedding);
  
  // Check Qdrant connection on startup
  await checkQdrantConnection();
})();

// Export a promise that resolves to the vector store
export const vectorStorePromise = QdrantVectorStore.fromExistingCollection(
  embeddings,
  {
    url: "http://localhost:6333",
    collectionName: "drift-collection-qdrant",
  }
);


// Add documents
export async function addDocs() {
  const vectorStore = await vectorStorePromise;
  const docs: Document[] = [
    { pageContent: "Overview of The Muscle Ladder: Get Jacked Using Science The book is a comprehensive, science-based guide to building muscle and developing a strong physique, suitable for beginners, intermediates, and advanced lifters. It uses a ladder metaphor to organize training principles: two vertical rails (sustainability and mindset) provide foundational support, while ten horizontal rungs represent prioritized variables for muscle growth, starting from basics and ascending to advanced concepts. The structure emphasizes focusing on mechanical tension as the primary driver of hypertrophy, asking the right questions for progress, and avoiding myths. It includes explanations of how and why for each principle, backed by research, with practical applications. Additional chapters cover nutrition, supplements, cardio, lifestyle factors, and 20 sample workout programs adaptable to 2-6 days per week, including full-body, upper/lower, push/pull/legs, body-part splits, and hybrids. The book features photo demonstrations for over 80 exercises, muscle diagrams, and serves as a reference for technique, programming, and common questions. It totals around 384 pages, with full-color images and an index, aiming to turn readers into their own fitness experts for long-term, sustainable gains. ### Chapter 1: Setting Up the Ladder This introductory chapter explains the ladder framework: rails as constant supports and rungs as progressive steps. It outlines how beginners should focus on lower rungs for foundational gains, while advanced lifters climb higher for optimization. The ladder prioritizes variables by impact on hypertrophy, ensuring efficient progress without overwhelming details. It stresses that results depend on applying principles consistently, with the structure allowing readers to troubleshoot plateaus by addressing specific rungs. ### Chapter 2: Sustainability - Will This Work Long Term? (Rail 1) Sustainability is one rail, ensuring training leads to maintainable gains. Key angles: enjoyment by selecting preferred exercises and routines to prevent burnout; safety through proper form, gradual progression, and injury prevention; pacing by listening to the body, incorporating deloads (reducing volume 50% every 4-8 weeks), and avoiding overtraining; realistic expectations, as progress slows over time (e.g., beginners gain faster than advanced). Without sustainability, dropout or injury halts progress. Examples include choosing machine variations if free weights cause discomfort and viewing training as a lifelong habit rather than a quick fix. ### Chapter 3: Mindset - Thinking Your Way to Gains (Rail 2) The other rail, mindset, drives adherence and maximum effort. Angles: positive self-talk for motivation during tough sets; building self-trust in one's ability to progress; resilience against plateaus by focusing on process over outcomes; treating training as an enjoyable habit. It integrates with all rungs, as psychological barriers can undermine physical execution. Examples: Using encouraging internal dialogue like You've got this and reframing failures as learning opportunities. The book notes mindset is crucial, as gains require consistent follow-through. ### Chapter 4: Technique - How to Lift the Weights (Rung 1) Technique is the foundational rung for maximizing muscle stimulation and minimizing injury. Angles: Control the eccentric (negative) phase for tension; use full range of motion (ROM) unless injury-limited; minimize momentum to avoid cheating; breathe by exhaling on exertion. Detailed instructions and photos for exercises emphasize proper form. Why: Poor technique reduces effectiveness and risks harm. Examples: Squats with upright torso and depth to parallel; bench press with elbows tucked at 45 degrees; deadlifts with neutral spine. Beginners must master this before advancing. ### Chapter 5: Exercise Selection - What Exercises Should I Do? (Rung 2) Focuses on choosing movements that target muscles effectively based on biomechanics and individual anatomy. Angles: Prioritize the Big Six compounds—squat-type (e.g., barbell back squat), hip hinge (e.g., deadlift), vertical push (e.g., overhead press), horizontal push (e.g., bench press), vertical pull (e.g., pull-up), horizontal pull (e.g., row)—for efficiency; add isolations (e.g., curls, extensions) for specifics. Match exercises to body proportions (e.g., front squats for long femurs). Muscle-by-muscle guides ensure balanced coverage. Examples: Back requires both vertical and horizontal pulls; legs mix quad-dominant (squats) and hamstring-dominant (RDLs). Photos demonstrate over 80 exercises. ### Chapter 6: Effort - How Hard Should I Push? (Rung 3) Effort involves training close to failure to recruit high-threshold motor units via mechanical tension. Angles: Use RPE (1-10 scale) and RIR (reps in reserve, e.g., 2 RIR means stop with 2 reps left); aim for 0-3 RIR on most sets for hypertrophy. Avoid constant failure to manage fatigue. Why: Insufficient effort limits growth. Examples: On a 10-rep set, if 12 are possible, that's 2 RIR; adjust based on feel. ### Chapter 7: Progressive Overload - How Do I Make Progress? (Rung 4) Core principle of increasing challenge to signal adaptation. Angles: Add weight, reps, sets, or improve form/ROM; track via logs; use double progression (increase reps before weight). Dismiss muscle confusion myths—consistency matters. Examples: From 225x8 bench to 225x9; apply to all levels, but plateaus require higher rungs. ### Chapter 8: Volume - How Much Should I Do? (Rung 5) Optimal sets per muscle per week. Angles: Beginners 10 sets; intermediates/advanced 10-20, up to 25+ for lagging areas; distribute across sessions; monitor recovery with landmarks (minimum effective volume, maximum adaptive/recoverable). Avoid junk volume. Examples: Quads 12-16 sets; training volume is a moving target based on response. ### Chapter 9: Training Splits and Frequency - How Often Should I Train? (Rung 6) Organizing workouts for balance. Angles: Splits like full-body (beginners), upper/lower, PPL, bro-split; frequency 1-3x per muscle/week if volume equated; pros/cons for recovery and schedule. Examples: 4-day upper/lower (Upper A, Lower A, rest, Upper B, Lower B); structure freely as long as bases covered. ### Chapter 10: Load and Rep Ranges - How Heavy? How Many Reps? (Rung 7) Balancing intensity and reps. Angles: 6-15 reps for hypertrophy (lower for compounds, higher for isolations); 1-5 for strength; mix for complete stimulus including metabolic stress. Examples: Squats 6-10 heavy; lateral raises 10-20; getting stronger builds muscle. ### Chapter 11: Rest Periods - How Long Should I Rest Between Sets? (Rung 8) Time between sets for recovery. Angles: 1-2 min isolation, 2-3 min light compounds, 3-5 min heavy; shorter for metabolites, longer for load maintenance. Examples: Curls 90 sec; deadlifts 4 min; rest as needed for optimal performance. ### Chapter 12: Advanced Techniques - How Can I Level Up My Training? (Rung 9) For plateaus, selectively use intensifiers on 10-20% of sets. Angles: Long-length partial reps, drop sets (reduce weight 20% after failure), myo-reps (activation set + mini-sets), forced reps, supersets. Why: Spark growth without overtaxing. Examples: Drop set continuation post-failure; for advanced lifters only. ### Chapter 13: Periodization - How Should I Organize My Training Over Time? (Rung 10) Structuring cycles to prevent stagnation. Angles: Macrocycles (yearly), mesocycles (4-12 weeks), microcycles; models like linear (increase intensity), reverse, weekly undulating; include deloads. Examples: Linear from 12 reps to 6 heavier over weeks. ### Chapter 14: Nutrition - How Should I Eat to Build Muscle? Calories in vs. out foundation. Angles: Calculate maintenance, bulk +200-500 kcal, cut -300-500, recomposition at neutral; protein 1.6-2.2g/kg bodyweight, fats 20-30%, carbs remainder; fiber 25-38g/day; flexible dieting (80/20). Surplus for growth, deficit for loss. Examples: 80kg person: 160g protein; track apps; intricate ROM and muscle diagrams aid understanding; poor nutrition derails recovery. ### Chapter 15: Supplements - What Supplements Should I Take? Supportive tools, not essential, tiered by evidence. Angles: Tier 1 (high): protein powder, creatine 5g/day, caffeine 3-6mg/kg pre-workout; Tier 2 (moderate): multivitamin, fish oil 1-2g EPA/DHA; Tier 3 (situational): L-citrulline 6-8g for pump, melatonin for sleep. Avoid overhyped like BCAAs. Not FDA-evaluated, not for disease treatment. ### Chapter 16: Cardio and Other Lifestyle Factors - What Else Affects Muscle Growth? Cardio for health/fat loss, not antagonistic to gains. Angles: HIIT 1-2x/week (20-30 min), LISS (walking) for NEAT/recovery; sleep 7-9 hours consistent; stress management (meditation, journaling). Recovery crucial. Examples: Post-workout walk; train with confidence, not fear. ### Chapter 17: Sample Workout Programs - Putting It All Together 20 flexible programs for all levels and splits. Angles: Beginner programs lower volume (8-10 sets/muscle), machine-focused for safety; intermediates/advanced incorporate techniques. Examples: Beginner PPL - Push (bench, overhead, triceps), Pull (rows, pull-ups, biceps), Legs (squats, RDLs); adaptable to schedules. ### Key Overall Takeaways and Quotes - The ladder builds progressively; top rungs for plateaus. - Comprehensive for physique improvement, simplifying concepts. - Quotes: By the time you reach the top, you’ll be answering questions instead of asking them. Technique is what allows you to train long enough and hard enough to reach your goals. The next eight steps won’t matter without the appropriate effort. Results depend on progressively increasing your strength, skill, and capacity in the gym. Training volume is a moving target. As long as you have those bases covered, you’re free to structure your training schedule to make it work for you. If you’re getting stronger, you’re almost certainly gaining muscle. Your rest periods should be exactly as long as they need to be for you to get the most out of every set of every exercise in your program. When plateaus become frequent, you may need to spice up your training with selective use of long-length partial reps, myo-reps, drop sets, and other hypertrophy techniques to spark new growth. As you step off this final rung, you’ll have all the knowledge you need to create a long-term training plan. Truly poor nutrition can derail your recovery. The best way to avoid getting hurt in the gym is to train with confidence rather than fear.", metadata: { category: "fitness" } },
    { pageContent: "Overview of Guide to Academic Success The guide provides strategies for effective studying productivity and career preparation emphasizing evidence-based techniques over common inefficient methods to achieve high performance while maintaining balance in school extracurriculars and personal life through active learning spaced repetition interleaving optimized breaks and practical tips for habits resumes and interviews. ### Introduction Discusses common student struggles like intense studying yielding low grades due to ineffective methods advocating learning how to learn for better retention less time spent and enjoyment of other activities covering pitfalls evidence-based techniques productivity hacks advice resume writing and interview tips. ### Why Listen to Me Highlights success in rigorous high school honors AP dual enrollment and college biomedical engineering BS/MS with 20-credit loads deans list while engaging in leadership clubs sports research internships at West Pharmaceutical Services GlaxoSmithKline entrepreneurship scholarship and family business help social life gym social media with 3M+ followers emphasizing techniques tested across disciplines like engineering biology computer science calculus composition material science anatomy entrepreneurship for efficiency and balance. ### What You Are Likely Doing Wrong Identifies traps like equating more hours to better performance leading to burnout pretty notes passive low utility wanting easy studying ignoring Yerkes-Dodson for optimal stress Parkinsons Law for intense short sessions and forgetting curve causing rapid loss without review inefficient for cumulative exams higher education. ### Evidence-Based Learning Techniques Details four principles for durable learning via sensory working long-term memory processes. ### Principle One Active Recall Defines deliberate retrieval strengthening pathways over cued flashcards illusion of knowing favoring synthesis reorganization comparison application contextualization with experiments showing retrieval outperforming repeated study concept mapping by 50% on verbatim inference questions despite inaccurate metacognitive predictions applying via pre-class prep familiarizing not memorizing in-class questions on fundamentals relations examples applications real-world without perfect wording immediate review struggling to answer deepening understanding Feynman technique simplifying for fifth grader revealing gaps blurting closing source writing comparing revising iterations for organization exam simulation past papers 7-step process attempting explaining distractors using class questions textbook checking for gaps. ### Principle Two Spaced Repetition Counters forgetting curve reviewing just before forgetting for desirable difficulty flattening curve shorter early intervals longer later with experiment showing spaced recall outperforming massed by 75% same time applying Leitner boxes/cards moving forward on success back on failure end-of-day 20-min retrieval for 70% retention reduction prospective timetables forward-planning blocks retrospective color-coding prioritizing unfamiliar/randomizing digital algorithms like Anki supplemental to free recall. ### Principle Three Interleaved Practice Mixes topics over blocked for spacing discernment real-world exam mimicry with experiment showing 30%+ grade boost applying switching subjects/topics in sessions homework post-familiarization ideal 25-90 min switches per ultradian rhythms. ### Principle Four Optimized Breaks Leverages rewiring in relaxation post-focus via naps 10-20 min for energy non-sleep deep rest guided meditations gap effects 1-10 sec idles 3-5 times/hour micro-rests random buzzers releasing tension reducing stress accelerating replays. ### Actually Putting Together the Perfect Study System Outlines syllabus topic identification daily pre-class prep in-class questions end-of-day review weekly interleaving spaced timetables homework/past papers blurting/Feynman encouraging experimentation for optimal personal system. ### Productivity Tips Leverage peak energy windows tracking experimenting aligning deep work second brain digital repository capturing organizing retrieving ideas for offloading building on past freeing creativity time blocking monthly/weekly/daily scheduling urgency realistic allocation timing tasks 5 minute rule starting small overcoming resistance 321 countdown acting on 1 eliminating second-guessing Pomodoro 25/45-min focus 5-min breaks night alarm two-stage winding down disengaging electronics stacking micro wins building momentum confidence mindfulness morning meditation intentions for presence alignment. ### Personal Advice for Students Develop network early class chats peer/teaching groups faculty connections for help recommendations research high value skills market demand transferability specialization future relevance earning like programming cloud data sales design content embracing difficulty resilience advanced classes good habits sleep study exercise cooking management cleanliness independence avoiding skipping cramming indoors imbalance no help dependency oversleeping. ### Resume Writing Focus impact quantifiable metrics 3-fold enhancement creating context standing out include keywords soft skills technical balance concise 475-600 words tailored versions reviewer mind comprehensive LinkedIn showcasing experiences networks personality shared interests customized URL. ### Interview Tips Strong introduction name background concentration motivation experiences alignment enthusiasm closing gratitude reiteration interest fit next steps emails final positive never tell show stories behavioral questions STAR situation task action result prepared questions demonstrating interest genuine assessment research company website LinkedIn Glassdoor Indeed current/previous employees for insights standing out. ### Closing Remarks Encourages integrating strategies for academic success believing in potential power persistence.", metadata: { category: "study" } },
    { pageContent: "Overview of The Seven Habits of Highly Effective People The book outlines seven habits based on timeless principles for personal and professional effectiveness shifting from personality ethic quick fixes to character ethic foundational traits like integrity emphasizing Inside-Out change starting with self for paradigm shifts to principle-centered living through private victories independence public victories interdependence and renewal. ### Part One: Paradigms and Principles - Inside Out Explains Inside-Out approach focusing on character over superficial techniques using examples of perception shifts like parenting challenges revealing underlying paradigms contrasting short-term personality tactics with long-term character building leading to primary greatness inner goodness over secondary social recognition. ### The Power of a Paradigm Describes paradigms as subjective maps influencing behavior with shifts enabling quantum change from negative to positive directions advocating focus on root paradigms for deep improvements. ### The Power of a Paradigm Shift Illustrates paradigm impacts with stories like lighthouse confrontation standing on principles and defines principles as universal natural laws like fairness and growth aligning maps for accuracy and effectiveness. ### See-Do-Get Cycle Links paradigms to behaviors and results using farm analogy for natural processes impossible to cram applying to development where timing avoids perceived judgment in strained relations. ### The Principle-Centered Paradigm Promotes centering on unchanging principles over variable centers like family or money reducing dependency and vulnerability for stable proactive living. ### The Way We See the Problem is the Problem Identifies problems from paradigms requiring principle-based deeper thinking for effective interactions. ### A New Level of Thinking Advocates paradigm shifts to interdependence recognizing ecological systems in nature and society defining habits at knowledge skill desire intersection for effectiveness along maturity continuum from dependence to independence to interdependence. ### Effectiveness Defined Introduces P/PC balance for sustainable results using golden goose fable applying to assets relationships and self where neglect diminishes capacity. ### Habit 1: Be Proactive Distinguishes proactive choice-based responses from reactive condition-driven ones using Frankl's camp freedom to highlight endowments self-awareness imagination conscience will enabling circle of influence focus over concern expansion through positive choices. ### Taking the Initiative Urges acting to create circumstances exercising proactive muscles for growth opportunities in individuals and organizations. ### Listening to Our Language Contrasts proactive choice language with reactive deterministic terms reflecting underlying attitudes. ### Circle of Influence/Circle of Concern Advises focusing on influence to expand it addressing direct habit indirect method and no-control attitude problems with serenity prayer perspective. ### Consequences and Mistakes Notes choices lead to natural or social consequences but response freedom remains using Joseph's rise as example. ### Making and Keeping Commitments Builds character via promises and goals central to influence. ### Proactivity Defined As responsibility fundamental to all habits. ### Habit 2: Begin with the End in Mind Uses end visualization for value clarification leading to mental first creation preceding physical for leadership over management rescripting default influences with personal mission statements based on principles. ### All Things Are Created Twice Emphasizes proactive design over default with examples like home construction. ### Rescripting Promotes mission statements as constitutions reflecting uniqueness via right-brain visualization and affirmation. ### At the Center Warns of dependency from centers like spouse or money impacting security guidance wisdom power. ### A Principle Center Provides stable security wise guidance unlimited power putting others in perspective. ### Writing and Using a Personal Mission Statement Involves roles goals regular review for decision criteria. ### Family and Organizational Mission Statements Foster shared vision through involvement for buy-in and culture like service-oriented hotel staff. ### Habit 3: Put First Things First Exercises independent will for management organizing priorities from mission via Quadrant II focus on important non-urgent prevention and building avoiding crises urgencies waste. ### Power of Independent Will Enables acting on principles over impulses for integrity. ### Quadrant II Organizes around roles goals weekly scheduling daily adapting with conscience for balance. ### Delegation Shifts from gofer methods to stewardship results focus empowering via desired results guidelines resources accountability consequences. ### Part Three: Public Victory - Paradigms of Interdependence Stresses emotional bank accounts for trust through deposits like understanding kindness honesty building reserves for withdrawals in interdependent realities requiring character maturity. ### Six Major Deposits Details understanding individual attending small things keeping commitments clarifying expectations integrity apologizing unconditional love as laws fostering growth. ### P Problems are PC Opportunities Views problems as capability building for production. ### Habits of Interdependence Require independence first for true Public Victory. ### Habit 4: Think Win-Win Promotes mutual benefit abundance mentality over scarcity win-lose lose-win etc in interdependent situations building character integrity maturity abundance for agreements processes systems. ### Six Paradigms of Human Interaction Analyzes win-win as only viable long-term with no deal alternative if needed. ### Win-Win Character Involves integrity maturity abundance mentality for genuine cooperation. ### Relationships and Agreements Build trust via emotional accounts and clear performance criteria with systems aligning to win-win. ### Processes Seek third alternatives through understanding. ### Habit 5: Seek First to Understand Then to Be Understood Advocates empathic listening over autobiographical responses like evaluating probing advising interpreting for accurate diagnosis before prescribing using ethos pathos logos sequence. ### Character and Communication Bases on integrity for open influence. ### Empathic Listening Transforms by providing psychological air fostering openness beyond content to feelings. ### Diagnose Before You Prescribe Applies to all fields for wise solutions. ### Four Autobiographical Responses Contrasts with empathic rephrasing content reflecting feeling for deeper understanding. ### Understanding and Perception Opens influence as needs met. ### Then Seek to Be Understood Presents from others frame courageously balanced with empathy. ### One on One Builds through regular empathic interactions. ### Habit 6: Synergize Values differences for creative cooperation where whole exceeds parts as in nature ecology seeking third alternatives through trust openness. ### Synergistic Communication Achieves high trust high cooperation for new solutions. ### Valuing the Differences Leverages mental emotional psychic variances for synergy requiring security humility. ### Force Field Analysis Uses driving restraining forces transformed via involvement. ### All Nature is Synergistic Interrelates everything maximizing creative powers in relationships. ### Habit 7: Sharpen the Saw Renews physical social/emotional spiritual mental dimensions balanced proactively for effectiveness like exercise nutrition service reading planning. ### Four Dimensions of Renewal Physical via exercise endurance flexibility strength social/emotional via empathy intrinsic security spiritual via mission review literature mental via reading visualizing planning. ### Scripting Others Empowers by seeing potential affirming proactively. ### Balance in Renewal Addresses organizational dimensions too for holistic growth. ### Synergy in Renewal Creates upward spiral of learn commit do. ### Inside-Out Again Reinforces starting with self for intergenerational impact becoming transition persons breaking negative cycles through forgiveness positive scripting.", metadata: { category: "work" } },
    { pageContent: "Law 1 Never Outshine the Master states that you must always ensure that those above you feel comfortably superior, and in your desire to please and impress them, do not go too far in displaying your talents or you might accomplish the opposite by inspiring fear and insecurity, so make your masters appear more brilliant than they are and you will attain the heights of power, and even if you're currently in favor, don't take it for granted as you can easily fall out of favor with the wrong moves, instead make those above you seem superior and smarter than you by asking for their help and attributing your ideas to their great advice. Law 2 Never Put Too Much Trust in Friends Learn How to Use Enemies warns to be wary of friends because they will betray you more quickly for they are easily aroused to envy, friends are more likely to betray you in haste as they are more prone to envy and also become spoiled and tyrannical, if you hire a former enemy they will prove themselves more trustworthy as they have more to prove, your enemies can be more useful and you can use them to create a sense of danger or rally people to your cause, if you can win over a former enemy he'll be more loyal than a friend because he'll try harder to prove himself worthy of your trust. Law 3 Conceal Your Intentions requires that you always hide your true intentions by creating a smokescreen and keeping your cards close to your chest, if you keep people off-balance and in the dark they can't counter your efforts, never say what you're really up to, concealing intentions isn't about deceit but about maintaining your strategic advantage. Law 4 Always Say Less Than Necessary teaches that you should say little and be ambiguous leaving the meaning to others to interpret, the less you say the more intimidating and powerful you are, powerful people impress by talking less, the more you say the more likely you are to say something foolish or revealing, keeping your words measured and controlled gives you more power and keeps others guessing about your intentions and capabilities. Law 5 So Much Depends on Reputation Guard It with Your Life emphasizes that you must nurture and guard your reputation because reputation is integral to power, with a strong reputation you can influence and intimidate others, reputation is the cornerstone of power, if you want to destroy someone attack their reputation, you can influence more people and gain more opportunities with a solid reputation therefore it's essential to protect it fiercely. Law 6 Court Attention at All Costs demands that you be outrageous or create an aura of mystery, any attention positive or negative is better than being ignored, attention brings you wealth, stand out from the crowd, be conspicuous and stand out as bad publicity is still publicity. Law 7 Get Others to Do the Work for You but Always Take the Credit instructs you to get others to do your work for you, use their skill time and energy to further your ambitions while taking full credit, you'll be admired for your efficiency, do what most bosses do which is use your team but present the result as if it happened because of you, save your time and energy while building your base. Law 8 Make Other People Come to You Use Bait if Necessary means you should make your opponent come to you, when you force others to act you're in control, bait them then attack, avoid chasing people but make others approach you and ask you for favors, make people come to you so you hold all the cards. Law 9 Win Through Your Actions Never Through Argument tells you to demonstrate your point rather than arguing, arguing rarely changes anyone's mind but people believe what they see and they're also less likely to be offended, talk is cheap but actions always speak louder, prove your point without offending people. Law 10 Infection Avoid the Unhappy and Unlucky warns you to avoid miserable people because the perpetually miserable spread misery like an infection and they'll drown you in it, don't get infected by misery and misfortune, avoid the losers and complainers and associate with the happy and the winners, associate with positive successful people. Law 11 Learn to Keep People Dependent on You requires that you make your superior dependent on you because the more she needs you the more security and freedom you have to pursue your goals, make yourself indispensable, keep people dependent on you so cutting you off becomes harder. Law 12 Use Selective Honesty and Generosity to Disarm Your Victim teaches you to use honesty and generosity to disarm and distract others from your schemes, even the most suspicious people respond to acts of kindness leaving them vulnerable to manipulation, one act of honesty will cover a dozen dishonest ones, first make them trust you and then you can deceive them significantly, disarm people with strategic honesty and generosity using these as tools to win over even suspicious people. Law 13 When Asking for Help Appeal to People's Self-Interest Never to Their Mercy or Gratitude states that when you need help from someone in a position of power you should appeal to their self-interest, they'll be glad to help if they'll get something in return and you'll get what you want without seeming desperate or irritating, if you need help don't remind people of the past good you've done for them but instead find what's in it for them today, get help by appealing to self-interest not goodness. Law 14 Pose as a Friend Work as a Spy instructs you to be friendly sympathetic and interested to get people to reveal their deepest thoughts and feelings, when you know your opponent's secrets you can predict his behavior and control him, gather intelligence and learn people's secrets by getting close to them, be a spy and gather intelligence to know your opponents. Law 15 Crush Your Enemy Totally demands that you crush your enemy completely because if you leave even one ember smoldering it will eventually ignite, you can't afford to be lenient, don't wound but kill, don't give them a chance to recover. Law 16 Use Absence to Increase Respect and Honor teaches that once you've become well-known don't wear out your welcome, the more you're seen and heard from the more you cheapen your brand, don't be too present, create value through scarcity and absence, raise your value through absence and scarcity and don't let people take you for granted. Law 17 Keep Others in Suspended Terror Cultivate an Air of Unpredictability requires that you throw others off balance and unnerve them with random unpredictable acts so you'll gain the upper hand, predictability makes you an easy target, make your moves more random and become more unpredictable, keep others in suspense by being unpredictable and keep them second-guessing. Law 18 Do Not Build Fortresses to Protect Yourself Isolation is Dangerous warns that you should never isolate yourself when under pressure because this cuts you off from information you need and when real danger arises you won't see it coming, isolation is dangerous and cuts you off from information so mingle with the people instead, don't isolate yourself behind a fortress but have eyes and ears everywhere. Law 19 Know Who You're Dealing With Do Not Offend the Wrong Person states that when attempting to deceive someone you must know who you're dealing with so you don't waste your time or stir up a hornets' nest in reaction, pick good targets and don't cross the wrong people, know your opponents and who you're dealing with and never deceive the wrong person. Law 20 Do Not Commit to Anyone instructs that you shouldn't commit to any side or cause except yourself, by maintaining your independence you remain in control and others will vie for your attention, you also have the ability to pit the sides against each other, maintain your independence as long as possible, stay neutral as long as possible to maintain your independence versus committing to one side. Law 21 Play a Sucker to Catch a Sucker Seem Dumber Than Your Mark teaches you to make your intended victims feel as though they're smarter than you are so they won't suspect you of having ulterior motives, seem dumber than you really are and your opponent will lower his guard, make your victims feel smarter than you so they drop their guard. Law 22 Use the Surrender Tactic Transform Weakness into Power means that when you're weaker you should surrender rather than fighting for the sake of honor because this gives you time to build strength and undermine your victor and you'll win in the end, don't fight until the bitter end but surrender and regroup, use surrender as a tool and bide your time for retaliation. Law 23 Concentrate Your Forces requires that you focus your resources and energies where you'll have the most impact or get the most benefit otherwise you'll waste limited time and energy, intensity and deep work yield better results, don't spread your forces too thin. Law 24 Play the Perfect Courtier tells you to learn the rules of the society you're playing in and follow them to avoid attracting unfavorable attention, this includes appearing like a team player and being careful about criticizing diplomatically, be a masterful courtier to balance the various players and power brokers. Law 25 Re-Create Yourself instructs that you should create a powerful image that stands out rather than letting others define you, change your appearance and emotions to suit the occasion, people who seem larger than life attract admiration and power, be the master of your own identity and don't let others define you, create your own identity and use it like a costume. Law 26 Keep Your Hands Clean acknowledges that you'll inevitably make mistakes or need to take care of unpleasant problems but you should keep your hands clean by finding others to do the dirty work and scapegoats to blame, use others to do illegal and immoral deeds while you look above reproach, get others to do your dirty work while keeping your hands clean. Law 27 Play on People's Need to Believe to Create a Cultlike Following requires that you offer people something to believe in and someone to follow, promise the world but keep it vague and whip up enthusiasm, people will respond to a desperate need for belonging, followers line your pockets and your opponents are afraid to rile them, create a cult-like following where you are the cult-master, play on what people want to see and hear. Law 28 Enter Action with Boldness states that when you act you should do so boldly and if you make mistakes correct them with even greater boldness, boldness brings admiration and power while timidity is weak, do it boldly and convinced or don't do it at all, act boldly so you seem confident. Law 29 Plan All the Way to the End teaches you to make detailed plans with a clear ending, take into account all possible developments then don't be tempted from your path otherwise you risk being surprised and forced to react without time to think, make your luck by drafting proper and accurate plans that begin from the most important part which is the end goal, plan till the end so you won't be caught by surprise. Law 30 Make Your Accomplishments Seem Effortless instructs that you should make difficult feats seem effortless so you'll inspire awe in others and seem powerful, by contrast when you make too much of your efforts your achievement will seem less impressive and you'll lose respect, you look immensely competent and powerful when you achieve your goals without breaking a sweat, don't show your real success secrets. Law 31 Control the Options Get Others to Play with the Cards You Deal requires that to deceive people you should seem to give them a meaningful choice but sharply limit their options to a few that work in your favor regardless of which they choose, your victims will feel in control but you'll pull the strings, make people feel like they had a choice but truly only give choices that see you as the winner, control the options but let people think they're in control. Law 32 Play to People's Fantasies teaches you to conjure up alluring fantasies in contrast to the gloomy realities of life and people will flock to you, spin the right tale and wealth and power will follow, give people what they want to hear not the truth, play to people's fantasies so they keep following you. Law 33 Discover Each Man's Thumbscrew states that everyone has a weakness or a hole in his armor, find it and it's leverage that you can use to your advantage, find your opponent's weaknesses insecurities and hot buttons, find your opponent's fatal weakness to break their defenses. Law 34 Be Royal in Your Own Fashion Act Like a King to Be Treated Like One instructs that you should act like royalty and people will treat you that way, project dignity and supreme confidence that you're destined for great things and others will believe it, act like the person you want to become, be regal and authoritative. Law 35 Master the Art of Timing requires that you anticipate the ebb and flow of power, recognize when the time is right and align yourself with the right side, be patient and wait for your moment because bad timing ends careers and ambitions, never seem in a hurry but look calm and collected like you always have things under control, strike only at the right hour. Law 36 Disdain Things You Cannot Have Ignoring Them Is the Best Revenge teaches that sometimes it's better to ignore things because reacting can make small problems worse make you look bad and give your enemy attention, if you can't have something pretend it doesn't even register in your brain, pretend it doesn't exist, feign disinterest and ignore what you can't have. Law 37 Create Compelling Spectacles states that in addition to words you should use visuals and symbols to underscore your power, what people see makes a greater impression on them than what they hear, dazzle people with big shows that cover the harsher reality that you don't want them to see, dazzle people with spectacles so they don't see what you're really doing. Law 38 Think as You Like But Behave Like Others warns that you shouldn't make a show of being different or people will think you look down on them and will retaliate against you, when you go against the grain in your communication you feel superior and people will resent you so blend in instead, hide your unorthodox thinking and pretend to blend in. Law 39 Stir Up Waters to Catch Fish instructs that you should always stay calm and objective because when you get angry you've lost control, but if you can make your enemies angry you gain an advantage, make your enemies angry and emotional as it's a great technique to stir water and make them angry and emotionally unhinged, make your enemies angry while you stay calm. Law 40 Despise the Free Lunch teaches you to use money and generosity strategically to achieve your goals, use gifts to build a reputation of generosity and also to obligate people to you, freebies come with strings attached so instead of taking freebies offer them because generosity is a sign and magnet for power, there are always strings attached. Law 41 Avoid Stepping Into a Great Man's Shoes states that if you succeed a great leader or famous parent you should find or create your own space to fill, sharply separate from the past and set your own standards or you'll be deemed a failure for not being a clone of your predecessor, don't follow great leaders in their footsteps or you look like a smaller hanger-on, carve your own path instead, chart a new course rather than try a big man's shoes. Law 42 Strike the Shepherd and the Sheep Will Scatter teaches that trouble in a group often starts with a single individual who stirs the pot so stop them before others succumb to their influence, deal with the problem at its source, strike the source of the trouble the leader or the main instigator, isolate the leader. Law 43 Work on the Hearts and Minds of Others requires that you win others' hearts and minds, play on their emotions and weaknesses and appeal to their self-interest so you'll have them eating out of your hand and they'll be less likely to turn on you, influence beats dominance, direct people gracefully and master the art of gentle influence, appeal to hearts meaning emotions first and foremost then deal with the mind meaning rationality, appeal to both feelings and logic. Law 44 Disarm and Infuriate with the Mirror Effect instructs you to seduce people by mirroring their emotions and interests and create the illusion that you share their values so they'll be so grateful to be understood that they won't notice your ulterior motives, copy what they do as it's a great technique to stir water and make them angry and emotionally unhinged, unbalance and confuse with the mirror effect by masking reality with illusion. Law 45 Preach the Need for Change But Never Reform Too Much at Once teaches that you should talk change but move slowly, evoke revered history and cloak your changes in familiar rituals because too much change is unsettling and will spark backlash, change is traumatic and people will resist it so make your changes slow and gentle, drastic reforms bring resistance so instead tackle change as a gentle improvement. Law 46 Never Appear Too Perfect warns that to forestall or mitigate envy you should admit to a flaw or weakness emphasize the role of luck or downplay your talents, if you don't recognize and nip envy in the bud it will grow and the envious will work insidiously against you, make the average mass feel closer to you with strategic vulnerability, don't seem too perfect or you'll invite jealousy. Law 47 Do Not Go Past the Mark You Aimed For In Victory Learn When to Stop states that when you've won don't let emotions push you past your goal because the moment of victory is dangerous and if you press your luck you'll blunder into something you haven't planned for, don't push too far but stop when you achieve your goal, don't push too far in victory and know when to stop. Law 48 Assume Formlessness requires that you be flexible fluid and unpredictable meaning formless so your opponents can't get a fix on you and can't figure out how to respond, everything changes and what worked today won't necessarily work tomorrow and you must adapt to thrive, be unpredictable and do not expose a visible plan. These 48 laws represent Greene's distillation of historical power dynamics and strategic thinking drawn from studying powerful figures throughout history and while controversial they offer insights into how power operates in various contexts from business and politics to personal relationships.", metadata: { category: "life" } },

  ];
  // await vectorStore.addDocuments(docs, { ids: [
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abc",
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abd",
  //   "b3b1a2e0-1234-4cde-8f1a-123456789abe"
  // ] });

  // Split each doc into smaller chunks
  const splitter = new RecursiveCharacterTextSplitter({ chunkSize: 800, chunkOverlap: 100 });
  let splitDocs: Document[] = [];
  for (const doc of docs) {
    const chunks = await splitter.splitText(doc.pageContent);
    splitDocs.push(...chunks.map(chunk => ({
      pageContent: chunk,
      metadata: doc.metadata,
    })));
  }

  await vectorStore.addDocuments(splitDocs);
  console.log("Knowledge base updated successfully")
}

// Query documents
export async function queryDocs(query: string, category: string) {
  const vectorStore = await vectorStorePromise;
  const filter = {
    must: [
      {
        key: "metadata.category",
        match: { value: category }
      }
    ]
  };
  // Use MMR search for diversity - balances relevance with diversity
  const results = await vectorStore.maxMarginalRelevanceSearch(
    query, 
    {
      k: 3,           // Number of results
      fetchK: 20,     // Number of candidates to consider
      lambda: 0.7,    // Balance between relevance (1.0) and diversity (0.0)
      filter: filter
    }
  );

  console.log("Relevant knowledge extracted")
  return results;
}